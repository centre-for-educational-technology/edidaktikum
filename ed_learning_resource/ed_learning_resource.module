<?php

require_once('ed_learning_resource_functions.inc');

/*
 * Implements hook_info().
 */
function ed_learning_resource_node_info() {
  $items['ed_learning_resource'] = array(
    'name' => t('Learning Resource'),
	  'type' => 'ed_learning_resource',
	  'base' => 'node_content',
	  'description' => t('Description'),
	  'has_title' => '1',
	  'title_label' => t('Title'),
	  'body_label' => t('body_label'),

  );
  return $items;
}

/*
 * Implements hook_form().
 */
function ed_learning_resource_form($node, $form_state) {
  return node_content_form($node, $form_state);
}


/*
 * Implements hook_menu().
 */
function ed_learning_resource_menu() {
  $items['resources'] = array(
    'title' => t('Resources'),
	  'page callback' => 'ed_learning_resource_listing_page',
	  'access callback' => TRUE,
	  'weight' => 7,
	  'menu_name' => 'main-menu',
	  'type' => MENU_NORMAL_ITEM,
  );
  return $items;
}


  /*
   * @return array
   *   Returns content.
   */
function ed_learning_resource_listing_page() {
  $content = array();
  $resources = _ed_get_resources();
  drupal_set_title(t('Learning Resources'));
  if(!empty($resources)) {

	  $nodes = node_load_multiple($resources);
	  $build = node_view_multiple($nodes);
	  $build['pager'] = array(
	    '#theme' => 'pager',
	    '#weight' => 5,
	  );
	  $content['resources'] = $build;


	/*echo "<pre>";
		print_r($content); // or var_dump()
	echo "</pre><br>";*/



	  return $content;
  }
  else {

  	$content['resources-heading'] = array(
	    '#type' => 'markup',
  	  '#markup' => '<h3>' . t('There are no available Learning Resources.') . '</h3>',
	  );

	/*
	echo "<pre>";
		print_r($content); // or var_dump()
	echo "</pre><br>";*/

	return $content;
  }
}

/*
 * Returns learning resource type nodes.
 */

function _ed_get_resources() {
  $query = db_select('node', 'n')
    ->fields('n', array('nid'))
  	->condition('n.type', 'ed_learning_resource');

	$nids = $query->execute()->fetchCol();
	return $nids;
}
